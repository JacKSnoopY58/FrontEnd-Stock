import{a as b}from"./upsvKRUO.js";import{_ as w,c as d,a as t,n as u,v as y,F as i,q as p,m,p as x,o as l,t as f,d as P}from"./Bpht06DM.js";const v={data(){return{searchQuery:"",paperSize:"A4",products:[],selectedProducts:[],generatedBarcodes:[],showBarcodePopup:!1}},computed:{filteredProducts(){return this.products.filter(s=>{const e=this.searchQuery.toLowerCase();return s.productName.toLowerCase().includes(e)||s.productNo.toLowerCase().includes(e)})}},methods:{async fetchProducts(){try{const s=await b.post("https://project-stock.onrender.com/api/products/products",{page:0,perpage:10,isuse:!0,max:"desc",search:this.searchQuery,stock:null,productType:null});this.products=s.data.data||[]}catch(s){console.error("Error fetching products:",s)}},selectProduct(s){this.selectedProducts.some(e=>e.productId===s.productId)||(this.selectedProducts.push({...s,productTotal:1}),this.searchQuery="")},removeProduct(s){this.selectedProducts.splice(s,1)},async generateBarcodes(){if(this.selectedProducts.length===0){alert("กรุณาเลือกสินค้าก่อนเพื่อสร้างบาร์โค้ด.");return}const s=this.selectedProducts.map(e=>({productId:e.productId,productTotal:e.productTotal}));try{const e=await b.post("https://project-stock.onrender.com/api/products/genbarcode",{products:s,isQr:!1},{responseType:"arraybuffer"}),g=new Blob([e.data],{type:"application/pdf"}),h=window.URL.createObjectURL(g),o=document.createElement("a");o.href=h,o.download="barcodes.pdf",o.click(),this.generatedBarcodes=[]}catch(e){console.error("Error generating barcodes:",e),alert("เกิดข้อผิดพลาดในการสร้างบาร์โค้ด. กรุณาลองใหม่.")}},closeBarcodePopup(){this.showBarcodePopup=!1},resetBarcodes(){this.selectedProducts=[]}},mounted(){this.fetchProducts()}},_={class:"p-4 bg-white rounded-lg shadow-lg"},k={class:"mb-4 relative"},B={key:0,class:"mt-2 absolute w-full bg-white border border-gray-300 rounded-md shadow-lg z-10"},C=["onClick"],Q=["src"],T={key:1,class:"mt-2 absolute w-full bg-white border border-gray-300 rounded-md shadow-lg"},N={key:0,class:"min-w-full bg-white border border-gray-300 rounded-lg shadow-md mb-4"},U={class:"p-2"},I=["src","alt"],S={class:"p-2"},V=["onUpdate:modelValue"],j={class:"p-2 text-center"},z=["onClick"],A={class:"mb-4"},L={class:"flex justify-between mt-4"},E={key:1},D=["src"];function q(s,e,g,h,o,c){return l(),d("div",_,[t("div",k,[e[6]||(e[6]=t("label",{for:"search",class:"block text-sm font-medium text-gray-700"}," ค้นหาสินค้า ",-1)),u(t("input",{type:"text",id:"search","onUpdate:modelValue":e[0]||(e[0]=r=>o.searchQuery=r),placeholder:"ค้นหาสินค้า",class:"mt-2 p-2 w-full border border-gray-300 rounded-md",onInput:e[1]||(e[1]=(...r)=>c.fetchProducts&&c.fetchProducts(...r))},null,544),[[y,o.searchQuery]]),o.searchQuery&&c.filteredProducts.length>0?(l(),d("div",B,[t("ul",null,[(l(!0),d(i,null,p(c.filteredProducts,(r,a)=>(l(),d("li",{key:a,class:"p-2 cursor-pointer hover:bg-gray-100 flex items-center space-x-2",onClick:n=>c.selectProduct(r)},[t("img",{src:r.imageUrl,alt:"Product Image",class:"w-8 h-8 object-cover rounded-full"},null,8,Q),t("span",null,f(r.productName),1)],8,C))),128))])])):o.searchQuery?(l(),d("div",T,e[5]||(e[5]=[t("p",{class:"p-2"},"ไม่พบสินค้าที่ค้นหา",-1)]))):m("",!0)]),o.selectedProducts.length>0?(l(),d("table",N,[e[7]||(e[7]=t("thead",null,[t("tr",{class:"bg-gray-100"},[t("th",{class:"p-2 text-left text-sm font-semibold text-gray-600"}," Product "),t("th",{class:"p-2 text-left text-sm font-semibold text-gray-600"},"Qty"),t("th",{class:"p-2 text-left text-sm font-semibold text-gray-600"}," Action ")])],-1)),t("tbody",null,[(l(!0),d(i,null,p(o.selectedProducts,(r,a)=>(l(),d("tr",{key:r.productId,class:"border-b"},[t("td",U,[t("img",{src:r.imageUrl,alt:r.productName,class:"w-16 h-16 object-cover"},null,8,I),P(" "+f(r.productName),1)]),t("td",S,[u(t("input",{type:"number","onUpdate:modelValue":n=>r.productTotal=n,min:"1",class:"w-16 text-center p-1 border border-gray-300 rounded-md"},null,8,V),[[y,r.productTotal]])]),t("td",j,[t("button",{onClick:n=>c.removeProduct(a),class:"text-red-500"}," Delete ",8,z)])]))),128))])])):m("",!0),t("div",A,[e[9]||(e[9]=t("label",{for:"paperSize",class:"block text-sm font-medium text-gray-700"},"ขนาดกระดาษ",-1)),u(t("select",{id:"paperSize","onUpdate:modelValue":e[2]||(e[2]=r=>o.paperSize=r),class:"mt-2 p-2 w-full border border-gray-300 rounded-md"},e[8]||(e[8]=[t("option",{value:"A4"},"A4",-1),t("option",{value:"A5"},"A5",-1)]),512),[[x,o.paperSize]])]),t("div",L,[t("button",{onClick:e[3]||(e[3]=(...r)=>c.generateBarcodes&&c.generateBarcodes(...r)),class:"bg-orange-500 text-white p-2 rounded-md hover:bg-orange-600"}," สร้างบาร์โค้ด "),t("button",{onClick:e[4]||(e[4]=(...r)=>c.resetBarcodes&&c.resetBarcodes(...r)),class:"bg-gray-300 text-gray-700 p-2 rounded-md hover:bg-gray-400"}," รีเซ็ต ")]),o.generatedBarcodes.length>0?(l(),d("div",E,[(l(!0),d(i,null,p(o.generatedBarcodes,r=>(l(),d("div",{key:r},[t("img",{src:"data:image/png;base64,"+r,alt:"Generated Barcode"},null,8,D)]))),128))])):m("",!0)])}const M=w(v,[["render",q]]);export{M as default};
